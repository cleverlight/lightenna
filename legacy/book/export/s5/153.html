<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<title>2.1. Queries</title>
<base href="" />
<meta name="generator" content="Drupal S5 Book Export" />
<meta name="version" content="S5 1.1" />
<meta name="presdate" content="(c) 2004-2007 Lightenna Ltd." />
<meta name="author" content="" />
<meta name="company" content="Lightenna Ltd." />
<meta name="defaultView" content="slideshow" />
<meta name="controlVis" content="hidden" />
<link rel="stylesheet" href="../../../../legacy/misc/s5/lightenna/slides.css" type="text/css" media="projection" id="slideProj" />
<link rel="stylesheet" href="../../../../legacy/misc/s5/default/outline.css" type="text/css" media="screen" id="outlineStyle" />
<link rel="stylesheet" href="../../../../legacy/misc/s5/default/print.css" type="text/css" media="print" id="slidePrint" />
<link rel="stylesheet" href="../../../../legacy/misc/s5/default/opera.css" type="text/css" media="projection" id="operaFix" />
<script src="../../../../legacy/misc/s5/default/slides.js" type="text/javascript"></script>
</head>
<body>

<div class="layout">
<div id="controls"></div>
<div id="currentSlide"></div>
<div id="header"></div>
<div id="footer"><h1>Database Training Course</h1><h2>2.1. Queries</h2></div>
</div>

<div class="presentation">
<div class="slide"><h1>2.1. Queries</h1>
<div class="slidebody"><p>In this lecture we look at...<br />
[<a href="../../../../legacy/sitefiles/lightenna.com/2.1.queries.pdf">Section notes</a> PDF 319Kb]</p>
</div></div><div class="slide"><h1>2.1.01 Introduction</h1>
<div class="slidebody"><ul>
<li>Methods of getting data out</li>
<li>The need for queries</li>
<li>QBE</li>
<li>SQL (design side)</li>
<ul>
<li>History</li>
<li>Schemas and relations (CREATE)</li>
<li>Data types and domains</li>
<li>DROP and ALTER</li>
</ul>
</ul>
</div></div><div class="slide"><h1>2.1.02. Querying interfaces</h1>
<div class="slidebody"><ul>
<li>High (view) level</li>
<li>Query-By-Example (QBE)</li>
<ul>
<li>Alternative to SQL</li>
<ul>
<li>Table driven (visually similar to relations)</li>
<li>Rather than script driven, hence intuitive over learned</li>
<li>Visual or text based</li>
</ul>
<li>User fills in templates</li>
<li>Microsoft Access approach</li>
</ul>
<p><a href="../../../../legacy/sitefiles/lightenna.com/qbe-access-example-big.gif"><img src="../../../../legacy/sitefiles/lightenna.com/qbe-access-example.gif" alt="Query-by-example from MS Access" /></a></p>
</div></div><div class="slide"><h1>2.1.02b. QBE visual example</h1>
<div class="slidebody"><ul>
<li>Record advancing</li>
<li>Query designing</li>
<ul>
<li>Finite domain attributes</li>
<li>Web search parallel</li>
</ul>
</ul>
<p><img src="../../../../legacy/sitefiles/lightenna.com/qbe-record-advance.jpg" alt="Record manoeuvring in Visual QBE (Access)" /><img src="../../../../legacy/sitefiles/lightenna.com/qbe-query-define.jpg" alt="Query definition in Visual QBE (Access)" /></p>
</div></div><div class="slide"><h1>2.1.03. QBE text-format example</h1>
<div class="slidebody"><ul>
<li>P. print, I. insert, D. delete, U. update</li>
<li>_VARNAME, copy field value into variable</li>
</ul>
<p><a href="../../../../legacy/sitefiles/lightenna.com/qbe-text-example-big.gif"><img src="../../../../legacy/sitefiles/lightenna.com/qbe-text-example.gif"  alt="Query by example (Text)" /></a></p>
</div></div><div class="slide"><h1>2.1.05. SQL</h1>
<div class="slidebody"><ul>
<li>Structured Query Language</li>
<ul>
<li>(SQL or SEQUEL)</li>
<li><a href="http://en.wikipedia.org/wiki/SQL">Wikipedia </a> reference</li>
</ul>
<li>Success of relational databases</li>
<li>Developed for SystemR at IBM</li>
<li>ANSI standardised</li>
<li>SQL-1986 (SQL1), ongoing extension</li>
<li>SQL-1992 (SQL2), current version (Oracle 9i)</li>
<li>SQL-1999 (SQL3), regular expression matching, recursive queries</li>
<li>SQL-2003, XML features, auto-generated columns</li>
</ul>
</div></div><div class="slide"><h1>2.1.05b. SQL command syntax</h1>
<div class="slidebody"><ul>
<li>Where follows here is a brief summary</li>
<ul>
<li>Oracle syntax</li>
<li>Similar but not identical to MySQL/MSSQL</li>
</ul>
<li>General familiarity</li>
<li>Query writing best learnt by doing it</li>
<li>Lecture live-example</li>
<li>Coursework 1 will be SQL</li>
<li><a href="http://www.cs.bris.ac.uk/maintain/oracle9docs/server.920/a96540/toc.htm">Oracle  (9i) SQL reference</a></li>
<li><a href="http://dev.mysql.com/doc/refman/5.0/en/sql-syntax.html">MySQL (5.0) SQL reference</a></li>
<ul>
</div></div><div class="slide"><h1>2.1.05c. SQL in application</h1>
<div class="slidebody"><ul>
<li>Keyword oriented language</li>
<li>Keywords not congruous with Relational model</li>
<li>Lots of different ways to write SQL</li>
<ul>
<li>Analogous to C/Java formatting</li>
<li>if (b==2) { a=1; } else { a=0; }</li>
</ul>
<li>Recommend using case to differentiate attributes and keywords</li>
<ul>
<li>SELECT colour, size, shape FROM fruit WHERE weight>22;</li>
</ul>
<li>Oracle user accounts on Teaching database</li>
<li>Namespace references, e.g. shared.cars</li>
</ul>
</div></div><div class="slide"><h1>2.1.06. SQL Create schema</h1>
<div class="slidebody"><ul>
<li>Data definition commands</li>
<li>CREATE</li>
<ul>
<li>SCHEMA &lt;schema_name&gt; AUTHORIZATION &lt;a&gt;</li>
<li>or workspace</li>
</ul>
<li>Beware of names</li>
<ul>
<li>Name collisions produce odd behaviours</li>
</ul>
<li>SQL Schema embraces Tables (relations), constraints, views, domains, authorizations</li>
</ul>
</div></div><div class="slide"><h1>2.1.07. SQL Create table</h1>
<div class="slidebody"><ul>
<li>CREATE TABLE</li>
<ul>
<li>&lt;schema_name&gt;.&lt;relation_name&gt;</li>
<li>(</li>
<ul>
<li>&lt;attribute_definitions&gt;</li>
<li>&lt;key&gt;</li>
<li>&lt;constraints&gt;</li>
</ul>
<li>)</li>
</ul>
<li><a href="../../../../legacy/sitefiles/lightenna.com/sql_create_table_example.txt">CREATE TABLE example (Oracle)</a></li>
<li>Tables can (and should) be indexed by user</li>
<li>e.g. &lt;username&gt;.&lt;tablename&gt;</li>
<li>Normal login implies username</li>
<li>Non-local table access</li>
</ul>
</div></div><div class="slide"><h1>2.1.08. Data types and domains (Oracle)</h1>
<div class="slidebody"><ul>
<li>Numeric</li>
<ul>
<li>ENUM</li>
<li>NUMBER, NUMBER(i), NUMBER(i,j)</li>
<ul>
<li>Formatted numbers, i precision, j scale</li>
<li>(number of digits total, after decimal point)</li>
</ul>
<li>Character-string</li>
<ul>
<li>CHAR(n) - n is length</li>
<li>VARCHAR2(n) - n is max</li>
</ul>
<li><a href="../../../../legacy/sitefiles/lightenna.com/sql_table_description.txt">DESCRIBE output example</a></li>
<li><a href="http://www.onlamp.com/pub/a/onlamp/2001/09/13/aboutSQL.html">Multi-database comparison of Datatypes</a></li>
<li>Database legacy: limited storage necessitated efficient storage</li>
<li>Does it need to be efficient anymore?</li>
</ul>
<p>You might consider all SQL types as being conceptually similar to attribute types in the relational model, although in reality the implementation of these types in a DBMS only approximates the mathematical purity of unordered domain sets etc.</p>
</div></div><div class="slide"><h1>2.1.08b. Data types and domains (MySQL)</h1>
<div class="slidebody"><ul>
<li>Numeric</li>
<ul>
<li>TINYINT, INT, INT UNSIGNED</li>
<li>FLOAT, DOUBLE, DECIMAL</li>
<li>ENUM</li>
<li>Character-string</li>
<ul>
<li>CHAR(n) - n is length</li>
<li>VARCHAR(n) - n is max</li>
<li>TINYTEXT, TEXT</li>
<li>Beware different default/maximum lengths to Oracle</li>
</ul>
<li>BLOB</li>
<li><a href="http://www.onlamp.com/pub/a/onlamp/2001/09/13/aboutSQL.html">Multi-database comparison of Datatypes</a></li>
</ul>
</div></div><div class="slide"><h1>2.1.09. Time-based data types</h1>
<div class="slidebody"><ul>
<li>Date and Time</li>
<ul>
<li>DATE</li>
<ul>
<li>Ten positions, components YYYY-MM-DD</li>
</ul>
<li>TIME</li>
<ul>
<li>Eight positions, components HH:MM:SS</li>
</ul>
<li>TIME(i)</li>
<ul>
<li>Time fractional seconds precision</li>
<li>Adds i+1 positions</li>
</ul>
<li>TIMESTAMP</li>
<ul>
<li>optionally WITH TIME ZONE</li>
</ul>
<li>Very sensitive to syntactical ambiguities</li>
<ul>
<li>day/month/year/hour/minute separators</li>
</ul>
</ul>
</div></div><div class="slide"><h1>2.1.10. DROPing</h1>
<div class="slidebody"><ul>
<li>DROP &lt;object&gt; &lt;obj_name&gt; &lt;flags&gt;</li>
<li>DROP SCHEMA &lt;schema_name&gt; CASCADE</li>
<ul>
<li>drops all workspace tables, domains</li>
</ul>
<li>DROP TABLE &lt;relation_name&gt; RESTRICT</li>
<ul>
<li>only drops table if</li>
<li>not referenced in any constraints/views</li>
</ul>
<li>Notion of cascading</li>
<li>Table links</li>
</ul>
</div></div><div class="slide"><h1>2.1.11. ALTERing</h1>
<div class="slidebody"><ul>
<li>Schema evolution</li>
<li>Design side</li>
<li>ALTER TABLE &lt;schema_name&gt;.&lt;relation_name&gt; ADD<br />
       &lt;var_name&gt; &lt;var_type&gt;;</li>
<li>Example</li>
<ul>
<li>ALTER TABLE uni.student ADD hall VARCHAR(32);</li>
</ul>
<li>Upper and lower case syntax</li>
<li>Naming conventions</li>
</ul>
</div></div><div class="slide"><h1>2.1.12. Queries</h1>
<div class="slidebody"><ul>
<li>Helper interfaces</li>
<ul>
<li>HeidiSQL/phpMyAdmin/Sword/SQLplus</li>
<li>Design/perform a lot of routine queries for you</li>
<li>Important to learn SQL, reinforcement</li>
<li>Designing select queries is more difficult</li>
<li>Visual interfaces still lacking in this area</li>
</ul>
<li>Select queries in SQL</li>
<li>Basic singlets</li>
<li>Renaming</li>
<li>Queries with Joins</li>
<li>Nested queries</li>
</ul>
</div></div><div class="slide"><h1>2.1.13. SQL Queries</h1>
<div class="slidebody"><ul>
<li>SELECT statement</li>
<li>Similar to relational data model SELECT then PROJECT</li>
<ul>
<li>SELECT &lt;attribute list&gt;</li>
<li>FROM &lt;table list&gt;</li>
<li>WHERE &lt;condition&gt;;</li>
</ul>
</ul>
<p><img src="../../../../legacy/sitefiles/lightenna.com/relation-select-project-operations.gif" alt="Select query cropping example" /></p>
</div></div><div class="slide"><h1>2.1.14. SQL Queries</h1>
<div class="slidebody"><ul>
<li>SELECT &lt;attr_list&gt;</li>
<ul>
<li>FROM R,S,T</li>
<li>WHERE DNO = 10</li>
</ul>
<li>equivalent to</li>
<li><font face=Symbol>p</font><sub>&lt;attr_list&gt;</sub>(</font><font face=Symbol>s</font><sub>DNO=10</sub> (R X S X T))</li>
<li>True-false evaluation tuple by tuple</li>
<li>WHERE clause as compound logical statement</li>
</ul>
</div></div><div class="slide"><h1>2.1.15. SQL Queries</h1>
<div class="slidebody"><ul>
<li>Produces a relation/set of tuples</li>
<li>Can be used to extract a single tuple</li>
<li>e.g. SELECT bday, age</li>
<ul>
<li>FROM student</li>
<li>WHERE fname='Tim' AND lname='Smith'</li>
<li>Result = (13-05-80, 20)</li>
</ul>
<li>Argument quoting (')</li>
<ul>
<li>SQL poisoning</li>
<li>Not null</li>
<li>Not numeric values</li>
</ul>
<li>MySQL Attribute quoting (`)</li>
<ul>
<li>Hypothetical attribute `all`, all, and ALL</li>
</ul>
</ul>
<p>SQL poisoning is a vulnerability exposed by inadequate escaping of arguments/variables used to compose SQL queries.</p>
<p>E.g. <i>Tim</i> in previous example, could be <i>Tim'; DELETE FROM student;' SELECT * FROM student WHERE 1</i></p>
</div></div><div class="slide"><h1>2.1.16. Renaming and referencing</h1>
<div class="slidebody"><ul>
<li>AS keyword</li>
<li>(Partial) Attribute renaming in projection list</li>
<ul>
<li>SELECT fname AS firstName, minit, lname AS surname...</li>
</ul>
<li>Role names for relations</li>
<ul>
<li>SELECT S.FNAME, F.FNAME, S.LNAME</li>
<ul>
<li>FROM STUDENT AS S, STUDENT AS F</li>
<li>WHERE S.LNAME=F.LNAME</li>
</ul>
</ul>
<li>(Total) Attribute renaming in FROM</li>
<ul>
<li>SELECT s.firstName, s.surname</li>
<ul>
<li>FROM student AS s(firstName,surname,DOB,NINO,tutor)</li>
</ul>
</ul>
<li>Wildcards (SELECT s.* FROM...)</li>
</ul>
</div></div><div class="slide"><h1>2.1.17. SQL Tables</h1>
<div class="slidebody"><ul>
<li>Relations are bags, not sets</li>
<ul>
<li>e.g. projection of non-key attributes</li>
</ul>
<li>Set cannot contain duplicate item/repetition</li>
<li>Duplicates exist in bags and be:</li>
<ul>
<li>SELECT DISTINCT (eliminated)</li>
<li>SELECT ALL (ignored/kept)</li>
</ul>
<p>   <br>
  </ul>
</div></div><div class="slide"><h1>2.1.18. Queries and Joins</h1>
<div class="slidebody"><ul>
<li>Relational database allows inter-related data</li>
<li>SQL select FROM gives Cartesian product</li>
<li>WHERE clause defines join condition</li>
<ul>
<li>SELECT proj.pnum, mgr.ssn</li>
<li>FROM project AS proj, employee AS mgr</li>
<li>WHERE proj.mgrssn = mgr.ssn;</li>
</ul>
<li>Alternatively, explicitly define join (note type)</li>
<ul>
<li>SELECT project.pnum, employee.ssn</li>
<li>FROM project INNER JOIN employee </li>
<li>ON project.mgrssn = employee.ssn;</li>
</ul>
</ul>
</div></div><div class="slide"><h1>2.1.18b. Outer joins</h1>
<div class="slidebody"><ul>
<li>Outer joins are crucial in the real-world</li>
<li>Databases often contain NULLs (3VL)</li>
<li>Analysis of where the crucial data is across a relationship</li>
<li>Previous example, only get project data for managed projects</li>
<ul>
<li>SELECT project.*, employee.*</li>
<li>FROM project INNER JOIN employee</li>
<li>ON project.mgrssn = employee.ssn;</li>
</ul>
</ul>
<p><a href="../../../../legacy/sitefiles/lightenna.com/sql-join-inner-big.gif"><img src="../../../../legacy/sitefiles/lightenna.com/sql-join-inner.gif" alt="Inner join example" border="0" /></a></p>
</div></div><div class="slide"><h1>2.1.18c. Outer joins (cont)</h1>
<div class="slidebody"><li>Scale of loss isn't always instantly obvious</li>
<li>NULLs often used unpredicably</li>
<li>May want project information, even if no employee attached as manager</li>
<ul>
<li>SELECT project.*, employee.*</li>
<li>FROM project LEFT OUTER JOIN employee</li>
<li>ON project.mgrssn = employee.ssn;</li>
</ul>
<p><a href="../../../../legacy/sitefiles/lightenna.com/sql-join-outer-big.gif"><img src="../../../../legacy/sitefiles/lightenna.com/sql-join-outer.gif" alt="Outer join example " border="0" /></a></p>
</div></div><div class="slide"><h1>2.1.19. 2y and 3y joins</h1>
<div class="slidebody"><ul>
<li>Queries can encapsulate any number of relations</li>
<ul>
<li>Even one relation many times (in different roles)</li>
</ul>
<li>Relationship chain</li>
<li>Across many relations</li>
<ul>
<li>Tuples as Entities OR Relationships</li>
</ul>
<li>e.g. Employee -&gt; Works_on -&gt; Project -&gt; Department -&gt;<br />
       Manager</li>
</ul>
</div></div><div class="slide"><h1>2.1.20. Recursive closure</h1>
<div class="slidebody"><ul>
<li>Can’t be done in SQL2</li>
<li>Recursive relationships</li>
<li>Unknown number of steps</li>
<li>SQL2 can’t generalise in single query</li>
</ul>
</div></div><div class="slide"><h1>2.1.21. Nested queries</h1>
<div class="slidebody"><ul>
<li>Essential one or more (inner) queries within an (outer) query</li>
<li>Inner and outer query</li>
<li>Not to be confused with inner and outer joins</li>
<li>Inner query can go in three places</li>
<ul>
<li>SELECT clause (projection list)</li>
<ul>
<li>Must return a single value, then aliased as attribute in outer result</li>
</ul>
<li>FROM clause</li>
<ul>
<li>Inner query result used as standard table in FROM cross product</li>
</ul>
<li>WHERE clause</li>
</ul>
</ul>
</div></div><div class="slide"><h1>2.1.21b. Nested query example</h1>
<div class="slidebody"><ul>
<li>Use of query result as comparator for other (outer) query</li>
<ul>
<li>SELECT DISTINCT course</li>
<li>FROM dept WHERE course IN (</li>
<ul>
<li>SELECT d.course</li>
<li>FROM dept AS d, faculty AS f, student AS s</li>
<li>WHERE d.ownfac=f.id AND s.owndept=d.id</li>
<li>AND f.name='Eng' AND s.year='3'</li>
</ul>
<li> ) OR course IN (</li>
<ul>
<li>SELECT course</li>
<li>FROM dept</li>
<li>WHERE code LIKE 'COMS3%');</li>
</ul>
</ul>
</div></div><div class="slide"><h1>2.1.22. Bridging SQL across 3 tiers</h1>
<div class="slidebody"><ul>
<li>Three tier database design</li>
<li>Changing role of DBMS</li>
<li>Indices</li>
<li>Aggregate functions (conceptual)</li>
<ul>
<li>Over bags and sub-bags</li>
</ul>
<li>Creating and updating views (ext)</li>
<li>SQL embedding</li>
</ul>
<p><img src="../../../../legacy/sitefiles/lightenna.com/database-three-tiers-external-conceptual-internal.gif" alt="Three tier database design (Internal, Conceptual, External)" /></p>
<p>In this subsection we look at the different roles SQL play across the three tiers of database design.  We discuss the areas in which SQL is lacking and how those difficiencies can be complemented by embedding SQL in other languages.</p>
</div></div><div class="slide"><h1>2.1.25. Indices</h1>
<div class="slidebody"><ul>
<li>Low/Internal level</li>
<li>Index by one attribute</li>
<li>For queries selecting by that attribute:</li>
<ul>
<li>Faster tuple access (ordered tuples)</li>
<li>Reduces database memory load</li>
<ul>
<li>Small cross product relation, only crosses requisites</li>
</ul>
<li>Accelerates query resolution time</li>
</ul>
<li>CREATE INDEX Index_Name ON RELATION(Attribute);</li>
</ul>
</div></div><div class="slide"><h1>2.1.26. Aggregate functions</h1>
<div class="slidebody"><ul>
<li>Run over groups of tuples</li>
<li>Takes a projected attribute list as an argument</li>
<li>Produce relation with single tuple</li>
<li>SUM, MAX, MIN, AVG, COUNT</li>
<li>e.g. AggFunc over all tuples</li>
<ul>
<li>SELECT SUM(SALARY), MAX(SALARY), MIN(SALARY)</li>
<li>FROM EMPLOYEE;</li>
</ul>
<li>Single attribute lists (distinct values)</li>
<li>Multi-attribute lists (granularity of distinct values by pairing)
  </ul>
</div></div><div class="slide"><h1>2.1.27. Aggregates over sub-bags</h1>
<div class="slidebody"><ul>
<li>Can run over subsets of tuples</li>
<li>GROUP BY keyword</li>
<li>Specifies the grouping attributes</li>
<li>Need to also appear in projected attr_list</li>
<li>Show result along side value for group attr</li>
<li>e.g. AggFunc over subgroups</li>
<ul>
<li>SELECT  dno, COUNT(*)</li>
<li>FROM employee</li>
<li>GROUP BY  dno</li>
</ul>
</ul>
<p>Quick SQL check, do all attributes in the SELECT projection list appear in the GROUP BY projection list.</p>
</div></div><div class="slide"><h1>2.1.28. Creating views</h1>
<div class="slidebody"><ul>
<li>Views are partial projections</li>
<li>Virtual relations, or views of live relations</li>
<li>Update synchronised</li>
<ul>
<li>CREATE VIEW &lt;virtual_relname&gt;</li>
<li>AS &lt;real_relation&gt;</li>
</ul>
<li>Real relation could be a query result</li>
<li>Clever bit is the change propagation</li>
<li>UPDATEs made to the view dataset are flooded back to relations</li>
<ul>
<li>INSERT and DELETE behaviour needs to be defined</li>
<li>Non-trivial as INSERT into view (virtual relation) may leave holes in real relation</li>
</ul>
</ul>
</div></div><div class="slide"><h1>2.1.29. Embedding SQL</h1>
<div class="slidebody"><ul>
<li>SQL (alone) can do lots of clever things in one expression
<li>
<li>But can only execute a single expression</li>
<li>Can structure SQL commands into proper programming languages</li>
<li>Java Database Connection (JDBC)</li>
<ul>
<li>javac, then java VM</li>
</ul>
<li>COBOL, C or PASCAL</li>
<ul>
<li>precompiled with PRO*COBOL or PRO*C</li>
</ul>
<li>Procedure Language (PL/SQL)</li>
<ul>
<li>Oracle/MySQL procedural language</li>
<li><i>Stored</i> procedures can take parameters</li>
</ul>
</ul>
</div></div>
</div>

</body>
</html>